function [Set, exitflag] = Voltage_control(Y, Vest, Slim, Set,maxunc)

Y2 = Y(2:end,2:end);
Z2 = inv(Y2);
R = real(Z2);
X = imag(Z2);
% R2 = diag(diag(real(Z2)));
% X2 = diag(diag(imag(Z2)));
Z = zeros(size(R));
% I = eye(size(R));
node_num = length(Z2);

H = [R, Z, Z; Z, X, Z; Z, Z, 100*R];
% H = [I, Z, Z; Z, I, Z; Z, Z, 100*I];
f = zeros(1,3*node_num);
% maxunc=[0.996284528086633,1.03621339607686,1.06336140334355,1.30135276101314,1.39071989779397,1.46833253882755,1.94914016813716,1.97742695164029,2.01623822931308,2.03035041274222,2.07753387729504,2.09214331212301,2.10703331910676,2.11888329582993,1.06509061266232,1.06630470952491,1.06747010160767,1.95254273622148,1.95599792789815,1.95657472137926,1.95668003232502,2.06027899866176,2.40617974605935,2.69396876487039,3.54398348438694,4.15983946934662,4.33016793588257,4.44127447186023,4.63591736259927,4.74816738660994,4.84745687691654,5.41912871105126,4.33109686597154,1.04581260838239,1.17632065412928,1.24190375499505,1.25587396673078,1.31207622742943,1.35828290041701,1.43893930291741,1.44135490336713,1.45860971180200,1.47242260282110,1.19700092495700,1.65922902032986,2.21254653041418,3.12066451108132,3.40608082178430,3.51606957579556,3.52618388337404,3.12527593054786,3.14944879124547,1.66206994881676,2.24155202643888,3.15383654062938,0.996355502926618,0.996995196877151,0.997062631125509,1.00044039003143,1.03490977429320,1.05523959721076,1.10166886203980,1.11144356522069,1.14943018964234,1.15347549318515,1.21933974287436,1.27592721399793,1.33243318938145,1.33694495995434,1.34700801742878,1.35125790345118,1.44602683921681,1.44895534091945,1.59075541762445,1.62917430044155,1.62983527687333,1.63050746508406,1.66365473361400,1.60224057783567,2.06502403537569,2.47134859137410,2.87650735180213,2.87892128908998,2.88556491582624,1.02254361767238,1.14404979087302,1.26542374983126,1.42432779759995,1.53081183981400,1.67258485361189,1.80616827777690,2.10528236826751,2.26387656569949,0.998416903142719,1.00117928036074,1.00325029452588,1.00386773396100,1.00431272687426,1.00209853299731]';
V = Vest.mag.true_val(2:end); 

% maxunc(maxunc>=5)=4.98;
Vmax = (1.05-maxunc(2:end)/100).*ones(node_num,1);
Vmin = (0.95+maxunc(2:end)/100).*ones(node_num,1);
% Vmax = 1.0375*ones(node_num,1);
% Vmin = 0.9625*ones(node_num,1);
% Vmax = 1.0475*ones(node_num,1);
% Vmin = 0.9525*ones(node_num,1);

Pess = Set.Pess;
Pdg = Set.Pdg;
Qdg = Set.Qdg;

A1 = [R,X,R];
b1 = Vmax - V + R*Pess + X*Qdg + R*Pdg;
A2 = -A1;
b2 = - Vmin + V - R*Pess - X*Qdg - R*Pdg;
A = [A1; A2];
b = [b1; b2];

Aeq = [];
beq = [];

lb = [-Slim.Pess;-Slim.Qdg;-Slim.Pdg];
ub = [Slim.Pess;Slim.Qdg;zeros(node_num,1)];
options = optimset('Display', 'off');
[y,~,exitflag,~] = quadprog(H,f,A,b,Aeq,beq,lb,ub,[],options);

Set.Pess = y(1:node_num);
Set.Qdg = y(node_num+1:2*node_num);
Set.Pdg = y(2*node_num+1:end);